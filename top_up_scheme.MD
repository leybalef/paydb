# [Домой](./README.MD)
### Описание схемы `top_up`
Схема платёжных систем для пополнений ЛК
Пока что есть СБП
## Таблицы


### `merch_scheme`
| Название поля | Тип данных | Описание поля          |
|----------------|------------|------------------------|
| idmerch        | int2       | Первичный ключ, автоинкремент, ID мерчанта |
| accesuaries    | jsonb      | Содержит JSONB объект с дополнительной информацией об оплате {"merch": 21,"descript": "оплата картой"} |
| login          | varchar(50)| Логин мерчанта |
| notification   | jsonb      | Содержит JSONB объект с текстом уведомления для клиента или может быть NULL. {"notification": "Cпасибо что вы с нами! Фискальный чек придёт на email!"} |
| enable         | bool       | Текущий статус мерча для пополнений |

### `order`
| Название поля | Тип данных       | Описание поля          |
|----------------|------------------|------------------------|
| param          | jsonb            | JSON с параметрами заказа |
| id_paybank     | int4             | Идентификатор платежной системы |
| enable         | `status_order`     | Статус заказа (новый, оплачен) |
| datetime       | timestamp(6)     | Время создания заказа |
| id_order       | varchar(50)      | Уникальный идентификатор заказа |

 Если заказ не оплачен, то id_order будет пустой(NULL) 
---

## Перечисления (Enums)
**status_order**
- `new`
- `paid`

---
---
---
---
---

## Последовательности

`merch_sch_idmerch_seq`
- **Описание**: Последовательность для автоинкрементного поля `idmerch` в таблице `merch_scheme`.
- **Тип**: **int2**; Диапазон: **1 - 32000**; База: **1**

---
---
---
---
---

## Функции

**`f_order(xjson json)`**
- Создает заказ на основе входных данных в формате JSON и возвращает статус операции.

**`f_order_id(xid_order character)`**
- Проверяет статус заказа по идентификатору и возвращает текущий статус.

**`f_order_status(xid_order character)`**
- Обновляет статус заказа после изменения в платежной системе и возвращает обновленный статус.

**`f_topup()`**
- Возвращает список активных мерчантов в системе в формате JSON.

---
---
---
---
---

## Триггеры

**`f_notify_paysys`**
- Применяется после изменения в заказе.
- Вызывает `f_notify_paysys` для отправки уведомления.
