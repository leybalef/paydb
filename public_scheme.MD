# [Домой](./README.MD)

# Описание схемы `public`
К сожалению доступа к данным нет, так что разобраться я не смог, но судя по DDL таблиц выполняет примерно следующее: управляет стандартными данными и объектами базы данных, которые доступны всем пользователям. Она содержит таблицы и последовательности, которые могут быть использованы для различных целей, включая хранение общих данных и выполнение стандартных операций. Включены функции для обработки данных, выполнения вычислений и выполнения общих задач, которые могут быть необходимы в разных частях системы.

## Таблицы

### `t_24alltime`
Содержит информацию о транзакциях за все время
| Название поля | Тип данных | Описание поля                       |
|---------------|------------|-------------------------------------|
| qtranz        | serial4    | Уникальный идентификатор транзакции |
| fljson        | jsonb      | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb      | Идентификатор платежного мерчанта   |
| verification  | int4       | Статус проверки                     |

### `t_breakesum`
Содержит информацию о суммах перерывов
| Название поля | Тип данных | Описание поля                             |
|---------------|------------|-------------------------------------------|
| idbreake      | smallserial| Уникальный идентификатор суммы перерыва   |
| json_breakesum| jsonb      | Дополнительные данные в формате JSON      |

### `t_ckassa`
Содержит информацию о транзакциях кассы
| Название поля | Тип данных | Описание поля                       |
|---------------|------------|-------------------------------------|
| qtranz        | serial4    | Уникальный идентификатор транзакции |
| fljson        | jsonb      | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb      | Идентификатор платежного мерчанта   |
| verification  | int4       | Статус проверки                     |

### `t_commparam`
Содержит параметры для отправки запросов о платежах принципалам
| Название поля | Тип данных | Описание поля                                 |
|---------------|------------|-----------------------------------------------|
| idcommparam   | serial4    | Уникальный идентификатор параметра            |
| enable        | bool       | Статус активации параметра                    |
| json_commparam| jsonb      | Дополнительные данные в формате JSON          |

### `t_commun`
Содержит данные коммуникаций
| Название поля | Тип данных  | Описание поля                            |
|---------------|-------------|------------------------------------------|
| idcommun      | serial4     | Уникальный идентификатор коммуникации    |
| NameComm      | varchar(50) | Имя коммуникации                         |
| Comment       | varchar(250)| Комментарий                              |
| template_answer| varchar(255)| Шаблон ответа                            |
| enable        | bool        | Статус активации коммуникации            |

### `t_department`
Содержит данные департаментов
| Название поля | Тип данных  | Описание поля                            |
|---------------|-------------|------------------------------------------|
| id            | smallserial | Уникальный идентификатор департамента    |
| name          | varchar(250)| Название департамента                    |
| en_name       | varchar(250)| Английское название департамента         |
| color         | varchar(20) | Цвет департамента                        |

### `t_descriptions`
Содержит описание данных
| Название поля | Тип данных  | Описание поля                            |
|---------------|-------------|------------------------------------------|
| id            | serial4     | Уникальный идентификатор                 |
| Name          | varchar     | Название                                 |
| description   | varchar     | Описание                                 |

### `t_firmservice`
Содержит данные фирм и сервисов
| Название поля  | Тип данных | Описание поля                            |
|----------------|------------|------------------------------------------|
| idfirm         | bpchar(6)  | Уникальный идентификатор фирмы           |
| enable         | bool       | Статус активации                         |
| fljson_firm    | jsonb      | Дополнительные данные в формате JSON     |

### `t_merchant`
Содержит данные мерчантов
| Название поля  | Тип данных | Описание поля                            |
|----------------|------------|------------------------------------------|
| idmerch        | serial4    | Уникальный идентификатор мерчанта        |
| xjson          | jsonb      | Дополнительные данные в формате JSON     |
| accesuaries    | jsonb      | Дополнительные аксессуары                |
| enable         | bool       | Статус активации мерчанта                |

### `t_onlinecassa`
Содержит данные онлайн касс
| Название поля  | Тип данных  | Описание поля                            |
|----------------|-------------|------------------------------------------|
| id_cassa       | smallserial | Уникальный идентификатор онлайн кассы    |
| accesuaries    | jsonb       | Дополнительные аксессуары                |

### `t_payberry`
Содержит данные платежей Payberry
| Название поля  | Тип данных | Описание поля                       |
|---------------|------------|-------------------------------------|
| qtranz        | int4       | Уникальный идентификатор транзакции |
| fljson        | jsonb      | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb      | Идентификатор платежного мерчанта   |
| verification  | int4       | Статус проверки                     |

### `t_payment`
Содержит данные платежей
| Название поля  | Тип данных  | Описание поля                                 |
|---------------|-------------|-----------------------------------------------|
| qtranz        | int4        | Уникальный идентификатор транзакции           |
| DateTime      | timestamp(6)| Дата и время транзакции                       |
| data_json     | jsonb       | Данные в формате JSON                         |
| answer        | varchar(255)| Ответ                                         |
| comm_json     | jsonb       | Комментарии в формате JSON                    |
| firm_json     | jsonb       | Данные фирмы в формате JSON                   |
| privilege_json| jsonb       | Привилегии в формате JSON                     |
| merch_json    | jsonb       | Данные мерчанта в формате JSON                |
| tarif_json    | jsonb       | Данные тарифа в формате JSON                  |
| idpaymerch    | jsonb       | Идентификатор платежного мерчанта             |

### `t_payview`
Содержит данные представлений платежей
| Название поля | Тип данных | Описание поля                             |
|---------------|------------|-------------------------------------------|
| id_payview    | int2       | Уникальный идентификатор представления платежа|
| payview       | varchar(255)| Представление платежа                    |

### `t_qiwi`
Содержит данные платежей QIWI
| Название поля | Тип данных | Описание поля                       |
|---------------|------------|-------------------------------------|
| qtranz        | serial4    | Уникальный идентификатор транзакции |
| fljson        | jsonb      | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb      | Идентификатор платежного мерчанта   |
| verification  | int4       | Статус проверки                     |

### `t_qiwiequar`
Содержит данные эквайринга QIWI
| Название поля  | Тип данных | Описание поля                            |
|----------------|------------|------------------------------------------|
| id_qiwiequar   | serial4    | Уникальный идентификатор эквайринга QIWI |
| json_inside    | jsonb      | Внутренние данные в формате JSON         |
| json_ansbank   | jsonb      | Данные банка в формате JSON              |
| json_callback  | jsonb      | Данные обратного вызова в формате JSON   |

### `t_rsbank`
Содержит данные RS банка
| Название поля  | Тип данных | Описание поля                            |
|----------------|------------|------------------------------------------|
| id_rsbank      | serial4    | Уникальный идентификатор банка           |
| json_inside    | jsonb      | Внутренние данные в формате JSON         |
| json_ansbank   | jsonb      | Данные банка в формате JSON              |
| json_callback  | jsonb      | Данные обратного вызова в формате JSON   |

### `t_sberequar`
Содержит данные эквайринга Сбербанка
| Название поля  | Тип данных | Описание поля                            |
|----------------|------------|------------------------------------------|
| id_sberequar   | serial4    | Уникальный идентификатор эквайринга Сбербанка |
| json_inside    | jsonb      | Внутренние данные в формате JSON         |
| json_ansbank   | jsonb      | Данные банка в формате JSON              |
| json_callback  | jsonb      | Данные обратного вызова в формате JSON   |

### `t_sbersms`
Содержит данные платежей СберСМС
| Название поля | Тип данных | Описание поля                       |
|---------------|------------|-------------------------------------|
| qtranz        | serial4    | Уникальный идентификатор транзакции |
| fljson        | jsonb      | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb      | Идентификатор платежного мерчанта   |
| verification  | int4       | Статус проверки                     |

### `t_service`
Содержит данные сервисов
| Название поля | Тип данных  | Описание поля                       |
|---------------|-------------|-------------------------------------|
| id_service    | smallserial | Уникальный идентификатор сервиса    |
| enable        | bool        | Статус активации сервиса            |
| json_service  | jsonb       | Дополнительные данные в формате JSON|

### `t_skysend`
Содержит данные платежей SkySend
| Название поля | Тип данных  | Описание поля                       |
|---------------|-------------|-------------------------------------|
| qtranz        | serial4     | Уникальный идентификатор транзакции |
| fljson        | jsonb       | Дополнительные данные в формате JSON|
| idpaymerch    | jsonb       | Идентификатор платежного мерчанта   |
| verification  | int4        | Статус проверки                     |

### `t_tarif`
Содержит данные тарифов
| Название поля | Тип данных  | Описание поля                       |
|---------------|-------------|-------------------------------------|
| idtarif       | serial4     | Уникальный идентификатор тарифа     |
| json_tarif    | jsonb       | Данные тарифа в формате JSON        |
| enable        | bool        | Статус активации тарифа             |

### `t_tranztarif`
Содержит данные тарифов транзакций
| Название поля | Тип данных  | Описание поля                       |
|---------------|-------------|-------------------------------------|
| idtranz       | serial4     | Уникальный идентификатор транзакции |
| Firm          | varchar(6)  | Название фирмы                      |
| Tarif         | int2        | Тариф                               |
| Syspay        | int2        | Платежная система                   |
| Breakesum     | int2        | Сумма перерыва                      |
| login         | int4        | Логин                               |
| Enable        | bool        | Статус активации                    |
| delay         | int2        | Задержка                            |

### `t_usergroup`
Содержит данные групп пользователей
| Название поля | Тип данных  | Описание поля                       |
|---------------|-------------|-------------------------------------|
| id_usergroup  | serial4     | Уникальный идентификатор группы     |
| name_usergroup| varchar(255)| Имя группы                          |


## Последовательности

### `t_24alltime_qtranz_seq`
- **Описание**: Последовательность для автоинкрементного поля `qtranz` в таблице `t_24alltime`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `t_breakesum_idbreake_seq`
- **Описание**: Последовательность для автоинкрементного поля `idbreake` в таблице `t_breakesum`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `t_ckassa_qtranz_seq`
- **Описание**: Последовательность для автоинкрементного поля `qtranz` в таблице `t_ckassa`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `t_commparam_idcommparam_seq`
- **Описание**: Последовательность для автоинкрементного поля `idcommparam` в таблице `t_commparam`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `t_commun_idcommun_seq`
- **Описание**: Последовательность для автоинкрементного поля `idcommun` в таблице `t_commun`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `t_department_id_seq`
- **Описание**: Последовательность для автоинкрементного поля `id` в таблице `t_department`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

и так далее

## Функции

**`calculate_breakesum(id int)`**
- Рассчитывает разбивку суммы на основе идентификатора и возвращает результат.

**`create_department(name varchar, description text)`**
- Создает новый отдел с заданным именем и описанием, возвращает ID нового отдела.

## Триггеры

**`after_create_department`**
- Применяется после создания нового отдела.
- Вызывает функцию `send_department_creation_notification` для отправки уведомления.