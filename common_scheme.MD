# [Домой](./README.MD)

# Описание схемы `common`
Схема управляет общими данными, используемыми в разных частях системы, включая информацию о банках, департаментах, организациях и регионах. Она содержит таблицы для параметров коммуникаций, тарифов, сервисов фирм и транзакционных тарифов, а также последовательности для генерации уникальных идентификаторов. Включены функции для работы с массивами, генерации паролей и UUID.

## Таблицы

### `banks`
Содержит данные банков
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| bik            | bpchar(9)    | БИК банка                           |
| name_bank      | varchar(50)  | Название банка                      |

### `breakesum`
Содержит данные сумм перерывов
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| idbreake       | smallserial  | Уникальный идентификатор перерыва   |
| json_breakesum | jsonb        | Данные сумм перерывов в формате JSON|

### `commparam`
Содержит параметры коммуникаций
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| idcommparam    | serial4      | Уникальный идентификатор параметра  |
| json_commparam | jsonb        | Данные параметра в формате JSON     |
| app            | varchar(10)  | Приложение                          |
| enable         | bool         | Статус активации параметра          |
Комментарий: Журнал документов данных отправки запросов о платежах принципалам

### `commun`
Содержит данные коммуникаций
| Название поля       | Тип данных   | Описание поля                       |
|---------------------|--------------|-------------------------------------|
| idcommun            | serial4      | Уникальный идентификатор коммуникации|
| NameComm            | varchar(50)  | Название коммуникации               |
| Comment             | varchar(250) | Комментарий                         |
| template_answer     | varchar(255) | Шаблон ответа                       |
| enable              | bool         | Статус активации                    |
Комментарий: views of communications

### `department`
Содержит данные департаментов
| Название поля       | Тип данных   | Описание поля                       |
|---------------------|--------------|-------------------------------------|
| id                  | varchar(12)  | Уникальный идентификатор департамента|
| name                | varchar(250) | Название департамента               |
| en_name             | varchar(250) | Английское название департамента    |
| color               | varchar(20)  | Цвет департамента                   |
Комментарий: Справочник соответствия организаций по договоору с пэйбэрии департаментам

### `firmservice`
Содержит данные сервисов фирмы
| Название поля       | Тип данных   | Описание поля                       |
|---------------------|--------------|-------------------------------------|
| idfirm              | bpchar(6)    | Уникальный идентификатор фирмы      |
| enable              | bool         | Статус активации                    |
| fljson_firm         | jsonb        | Данные фирмы в формате JSON         |
| idcommparam         | int4         | Идентификатор параметра коммуникации|
| firm                | varchar(4)   | Название фирмы                      |
| service             | varchar(4)   | Название сервиса                    |
| location            | varchar(255) | Локация                             |

### `merchant`
Содержит данные мерчантов
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| xjson          | jsonb        | Дополнительные данные в формате JSON|
| idmerch        | serial4      | Уникальный идентификатор мерчанта   |
| accesuaries    | jsonb        | Аксессуары                          |
| enable         | bool         | Статус активации                    |

### `organisations`
Содержит данные организаций
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| inn_org        | bpchar(12)   | ИНН организации                     |
| name_org       | varchar(50)  | Название организации                |
| form_org       | varchar(30)  | Форма организации                   |
| id_firm        | varchar(2)   | Идентификатор фирмы                 |

### `region_code`
Содержит данные регионов
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| id_region      | varchar(2)   | Уникальный идентификатор региона    |
| region_name    | varchar(255) | Название региона                    |

### `service`
Содержит данные сервисов
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| id_service     | varchar(16)  | Уникальный идентификатор сервиса    |
| enable         | bool         | Статус активации                    |
| json_service   | jsonb        | Данные сервиса в формате JSON       |
| service_name   | varchar(50)  | Название сервиса                    |

### `tarif`
Содержит данные тарифов
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| idtarif        | serial4      | Уникальный идентификатор тарифа     |
| enable         | int2         | Статус активации                    |
| json_tarif     | jsonb        | Данные тарифа в формате JSON        |

### `tranztarif`
Содержит данные тарифов транзакций
| Название поля  | Тип данных   | Описание поля                       |
|----------------|--------------|-------------------------------------|
| idtranz        | serial4      | Уникальный идентификатор транзакции |
| Firm           | varchar(6)   | Название фирмы                      |
| Tarif          | int4         | Тариф                               |
| Syspay         | int2         | Платежная система                   |
| Breakesum      | int2         | Сумма перерыва                      |
| login          | bpchar(10)   | Логин                               |
| Enable         | int4         | Статус активации                    |
| delay          | int4         | Задержка                            |

Комментарий: список тарифов, используемых для пары: фирма-плат.система

## Последовательности

### `breakesum_idbreake_seq`
От 1 до 9223372036854775807, кэш есть, зацикливания нет.

### `commparam_idcommparam_seq`
От 1 до 9223372036854775807, кэш есть, зацикливания нет.

### `commun_idcommun_seq`
От 1 до 9223372036854775807, кэш есть, зацикливания нет.

### `merchant_idmerch_seq`
От 1 до 2147483647, кэш есть, зацикливания нет.

### `service_id_service_seq`
От 1 до 2147483647, кэш есть, зацикливания нет.

### `tarif_idtarif_seq`
От 1 до 9223372036854775807, кэш есть, зацикливания нет.

### `tranztarif_idtranz_seq`
От 1 до 9223372036854775807, кэш есть, зацикливания нет.

## Функции

### `common.f_array(xarray character varying)`
Функция на языке Python, возвращающая первый элемент массива.
1. Преобразует строку `xarray` в массив.
2. Возвращает первый элемент массива.

### `common.f_gen_pass_bcript()`
Функция на языке Python, генерирующая зашифрованный пароль.
1. Создает пароль `passwd`.
2. Генерирует соль для шифрования.
3. Создает хэш пароля с использованием соли.
4. Возвращает зашифрованный пароль.

### `common.f_timestamp()`
Функция для получения текущей метки времени.
1. Извлекает текущую метку времени в часовом поясе `Europe/Moscow`.
2. Возвращает метку времени.

### `common.uuid_v7_gen()`
Функция для генерации UUID версии 7.
1. Генерирует случайные значения и текущую метку времени.
2. Создает UUID на основе метки времени и случайных значений.
3. Возвращает сгенерированный UUID.