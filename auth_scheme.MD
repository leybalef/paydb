# [Домой](./README.MD)

# Описание схемы `auth`
Схема управляет аутентификацией и авторизацией пользователей, включая хранение информации о пользователях, их группах и привилегиях. Она содержит таблицы для данных пользователей с поддержкой партиционирования по логину, а также функции для получения и обработки информации о пользователях.

## Таблицы

### `usergroup`
Содержит данные групп пользователей
| Название поля    | Тип данных  | Описание поля                       |
|------------------|-------------|-------------------------------------|
| id_usergroup     | serial4     | Уникальный идентификатор группы    |
| name_usergroup   | varchar(255)| Название группы                    |

### `users`
Содержит данные пользователей
| Название поля    | Тип данных  | Описание поля                       |
|------------------|-------------|-------------------------------------|
| login_master     | bpchar(10)  | Логин мастера                       |
| login_slave      | varchar(50) | Логин слейва                        |
| password         | varchar(255)| Пароль                              |
| enable           | bool        | Статус активации                    |
| attributies      | jsonb       | Атрибуты в формате JSON             |
| user_group       | int2        | Группа пользователя                 |
| fld_uuid         | uuid        | UUID                                |
Комментарий: Таблица с партиционированием по диапазону `login_master`

### `users1`
Содержит данные привилегий пользователей
| Название поля    | Тип данных  | Описание поля                       |
|------------------|-------------|-------------------------------------|
| idpriv           | int4        | Уникальный идентификатор привилегии |
| fljson_privilege | jsonb       | Привилегии в формате JSON           |

### `users_900`
Содержит данные пользователей с логином от '9000000000' до '9250000000'
| Название поля    | Тип данных  | Описание поля                       |
|------------------|-------------|-------------------------------------|
| login_master     | bpchar(10)  | Логин мастера                       |
| login_slave      | varchar(50) | Логин слейва                        |
| password         | varchar(255)| Пароль                              |
| enable           | bool        | Статус активации                    |
| attributies      | jsonb       | Атрибуты в формате JSON             |
| user_group       | int2        | Группа пользователя                 |
| fld_uuid         | uuid        | UUID                                |

### `users_925`
Содержит данные пользователей с логином от '9250000000' до '9500000000'

### `users_950`
Содержит данные пользователей с логином от '9500000000' до '9750000000'

### `users_975`
Содержит данные пользователей с логином от '9750000000' до '9999999999'

## Типы

## Последовательности

### `usergroup_id_usergroup_seq`
Последовательность для генерации уникальных идентификаторов групп пользователей
- От 1 до 2147483647, кэш есть, зацикливания нет.

### `users_idpriv_seq`
Последовательность для генерации уникальных идентификаторов привилегий пользователей
- От 1 до 2147483647, кэш есть, зацикливания нет.

## Функции

### `auth.f_api_users(xlogin character)`
Функция для получения данных пользователя по логину.
1. Извлекает значение логина из входного параметра `xlogin`.
2. Ищет логин в таблице `auth.users`.
3. Если логин не найден, возвращает JSON с сообщением "Not found".
4. Если логин найден, извлекает атрибуты пользователя и возвращает их в формате JSON.