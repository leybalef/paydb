# [Домой](./README.MD)

### Описание схемы `mytosb`
Схема управляет данными, связанными с контрактами и платежными системами. Она включает таблицы для хранения информации о контрагентах, платежных системах и выполненных платежах. Включены функции для обработки данных контрактов, генерации отчетов и выполнения различных операций, связанных с платежами и взаимодействием с контрагентами.

## Таблицы

### `contracts`
| Название поля    | Тип данных  | Описание поля                               |
|------------------|-------------|--------------------------------------------|
| id_tranzservice  | int         | Идентификатор транзакционного сервиса       |
| inn_firm         | bpchar(12)  | ИНН компании                                |
| bank             | bpchar(9)   | Банк компании                               |
| merchant         | int2        | Идентификатор мерчанта                      |
| service          | int2        | Идентификатор сервиса                       |
| ekassa           | jsonb       | JSON с информацией о кассовых операциях     |
| type_sys         | varchar(10) | Тип системы                                 |
| enable           | bool        | Статус активности                           |
| firmservice      | varchar(10) | Идентификатор фирменного сервиса            |
| contragent       | int4        | Идентификатор контрагента                   |
| bank_core        | bpchar(20)  | Основной банк компании                      |
| login_phone      | bpchar(12)  | Телефонный номер для входа                  |

### `info`
| Название поля    | Тип данных  | Описание поля                               |
|------------------|-------------|--------------------------------------------|
| firm             | varchar     | Название компании                           |
| inn              | varchar     | ИНН компании                                |
| bank             | varchar     | Банк компании                               |
| syspay           | int         | Идентификатор платежной системы             |
| type_syspay      | varchar     | Тип платежной системы                       |
| ecassa           | json        | JSON с информацией о кассовых операциях     |
| service          | int         | Идентификатор сервиса                       |

### `syspay`
| Название поля    | Тип данных  | Описание поля                               |
|------------------|-------------|--------------------------------------------|
| id_paybank       | int         | Идентификатор платежного банка              |
| json_inside      | json        | JSON с внутренней информацией               |
| json_tobank      | json        | JSON с информацией для банка                |
| json_answer      | json        | JSON с ответом                              |
| json_callback    | json        | JSON с информацией обратного вызова         |
| idpay            | json        | JSON с идентификатором платежа              |
| enable           | bool        | Статус активности                           |

### `users`
| Название поля    | Тип данных  | Описание поля                               |
|------------------|-------------|--------------------------------------------|
| id_users         | varchar     | Идентификатор пользователя                  |
| pass             | varchar     | Хэш пароля                                  |
| descriptions     | varchar     | Описание пользователя                       |

### `xcount_agent`
| Название поля    | Тип данных  | Описание поля                               |
|------------------|-------------|--------------------------------------------|
| count            | int         | Счетчик                                     |

---

## Последовательности

### `contracts_id_tranzservice_seq`
- **Описание**: Последовательность для автоинкрементного поля `id_tranzservice` в таблице `contracts`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `info_syspay_seq`
- **Описание**: Последовательность для автоинкрементного поля `syspay` в таблице `info`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `syspay_id_paybank_seq`
- **Описание**: Последовательность для автоинкрементного поля `id_paybank` в таблице `syspay`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `users_id_users_seq`
- **Описание**: Последовательность для автоинкрементного поля `id_users` в таблице `users`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

### `xcount_agent_count_seq`
- **Описание**: Последовательность для автоинкрементного поля `count` в таблице `xcount_agent`.
- **Тип**: **serial**; Диапазон: **1 - 2147483647**; База: **1**

---

## Функции

**`calculate_tranzservice(id int)`**
- Рассчитывает транзакционный сервис на основе идентификатора и возвращает результат.

**`create_user(name varchar, pass varchar)`**
- Создает нового пользователя с заданным именем и паролем, возвращает ID нового пользователя.

---

## Триггеры

**`after_create_user`**
- Применяется после создания нового пользователя.
- Вызывает функцию `send_user_creation_notification` для отправки уведомления.